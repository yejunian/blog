---
import { getCollection } from "astro:content";

import PostListLayout from "@/layouts/PostListLayout.astro";

const sortedPosts = (await getCollection("blogPost")).toSorted((a, b) => {
  if (b.data.date < a.data.date) {
    return -1;
  } else if (b.data.date > a.data.date) {
    return 1;
  } else {
    return 0;
  }
});

const recentPosts = sortedPosts.slice(0, 10);

const availableYears = Array.from(
  sortedPosts.reduce<Set<string>>((acc, { data: { date } }) => {
    return acc.add(date.split("-")[0]);
  }, new Set()),
);
---

<PostListLayout
  showCategoryList
  showPostList
  isRecentPostList
  posts={recentPosts}
  isYearFilterVisible
  availableYears={availableYears}
/>
